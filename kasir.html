<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kasir Modern</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: #e9f5ff;
      color: #333;
    }

    header {
      background: #2196f3;
      color: white;
      text-align: center;
      padding: 12px;
      font-size: 1.4em;
      letter-spacing: 0.5px;
    }

    /* === NAVBAR === */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      background: #bbdefb;
      padding: 8px 16px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .navbar-left {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .navbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      background: #2196f3;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: 500;
      transition: 0.25s;
      white-space: nowrap;
    }

    .btn:hover {
      background: #1976d2;
      transform: scale(1.05);
    }

    .navbar input[type="text"] {
      padding: 7px 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 220px;
      transition: 0.3s;
    }

    .navbar input[type="text"]:focus {
      outline: none;
      border-color: #2196f3;
      box-shadow: 0 0 4px #90caf9;
    }

    /* === LAYOUT === */
    .container {
      display: flex;
      height: calc(100vh - 120px);
    }

    .menu {
      flex: 3;
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 12px;
      background: #e3f2fd;
      overflow-y: auto;
    }

    .order {
      flex: 1.2;
      background: #f1f8ff;
      padding: 12px;
      display: flex;
      flex-direction: column;
    }

    /* === KARTU MENU === */
    .card {
      background: #fff;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: 0.25s;
    }

    .card:hover {
      background: #e1f5fe;
      transform: scale(1.05);
    }

    .card img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 5px;
    }

    /* === PESANAN === */
    .order-list {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 12px;
      background: #fff;
      border-radius: 10px;
      padding: 8px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px;
      border-bottom: 1px solid #ddd;
    }

    .input {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    .order-actions {
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }

    /* === POPUP === */
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .popup-content {
      background: white;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      width: 90%;
      max-width: 350px;
    }

    .spinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 6px solid #ccc;
      border-top: 6px solid #2196f3;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      z-index: 100;
    }

    @keyframes spin {
      100% {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }

    /* === RESPONSIVE === */
    @media (max-width: 800px) {
      .container {
        flex-direction: column;
        height: auto;
      }
      .navbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .navbar-right {
        width: 100%;
        justify-content: flex-start;
      }
      .navbar input[type="text"] {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <header id="restoName">Kasir</header>

  <!-- === NAVBAR === -->
  <div class="navbar">
    <div class="navbar-left">
      <button class="btn" onclick="logout()">⬅ Kembali</button>
      <button class="btn" onclick="filterMenu('Semua')">Semua</button>
      <button class="btn" onclick="filterMenu('Makanan')">Makanan</button>
      <button class="btn" onclick="filterMenu('Minuman')">Minuman</button>
      <button class="btn" onclick="filterMenu('Cemilan')">Cemilan</button>
      <button class="btn" onclick="openPopup('pengeluaranPopup')">+ Pengeluaran</button>
    </div>

    <div class="navbar-right">
      <input type="text" id="searchInput" placeholder="Cari menu..." oninput="searchMenu()" />
    </div>
  </div>

  <!-- === ISI HALAMAN === -->
  <div class="container">
    <div class="menu" id="menuList"></div>

    <div class="order">
      <div class="order-list" id="orderList"></div>
      <div>
        <p>Total: Rp <span id="total">0</span></p>
        <input type="number" id="diskon" class="input" placeholder="Diskon (Rp)" oninput="hitungKembalian()" />
        <input type="number" id="bayar" class="input" placeholder="Bayar" oninput="hitungKembalian()" />
        <p>Kembalian: Rp <span id="kembalian">0</span></p>
        <div class="order-actions">
          <button class="btn" onclick="resetPesanan()">Reset</button>
          <button class="btn" onclick="konfirmasiBayar()">Bayar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- === POPUP NOTIFIKASI === -->
  <div class="popup" id="notifPopup">
    <div class="popup-content">
      <p id="notifMessage"></p>
      <button class="btn" onclick="closePopup('notifPopup')">OK</button>
    </div>
  </div>

  <div class="spinner" id="spinner"></div>

  <!-- === SCRIPT ASLI (tidak diubah) === -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://dxcaivedoitovhjtyhxe.supabase.co";
    const SUPABASE_KEY = "sb_publishable_Qw4tlM2CtchoDM4TDGWPkA_gCeYarzs";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let kasir = sessionStorage.getItem("kasir") || "";
    let allMenu = [];
    let filter = "Semua";
    let searchQuery = "";
    let pesanan = [];
    let totalHarga = 0;

    document.getElementById("restoName").innerText =
      localStorage.getItem("namaResto") || "RESTO BUNDA RITA";

    document.addEventListener("DOMContentLoaded", async () => {
      if (!kasir) {
        showNotif("Silakan login terlebih dahulu.");
      } else {
        await loadMenu();
      }
    });

    async function loadMenu() {
      showSpinner(true);
      const { data, error } = await supabase.from("menu").select("*");
      showSpinner(false);
      if (!error) {
        allMenu = data;
        renderMenu();
      } else {
        showNotif("Gagal memuat menu.");
      }
    }

    function renderMenu() {
      const menuList = document.getElementById("menuList");
      menuList.innerHTML = "";
      allMenu
        .filter((m) => filter === "Semua" || m.kategori === filter)
        .filter((m) => m.nama.toLowerCase().includes(searchQuery))
        .forEach((m) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <img src="${m.gambar || "https://via.placeholder.com/100"}">
            <b>${m.nama}</b><br>Rp ${m.harga.toLocaleString("id-ID")}
          `;
          card.onclick = () => tambahPesanan(m);
          menuList.appendChild(card);
        });
    }

    function filterMenu(kat) {
      filter = kat;
      renderMenu();
    }

    function searchMenu() {
      searchQuery = document.getElementById("searchInput").value.toLowerCase();
      renderMenu();
    }

    function tambahPesanan(m) {
      const item = pesanan.find((p) => p.nama === m.nama);
      if (item) item.jumlah++;
      else pesanan.push({ nama: m.nama, harga: m.harga, jumlah: 1 });
      renderPesanan();
    }

    function renderPesanan() {
      const list = document.getElementById("orderList");
      list.innerHTML = "";
      totalHarga = 0;
      pesanan.forEach((p, i) => {
        totalHarga += p.harga * p.jumlah;
        const row = document.createElement("div");
        row.className = "order-item";
        row.innerHTML = `
          <span>${p.nama} x${p.jumlah} - Rp ${(p.harga * p.jumlah).toLocaleString("id-ID")}</span>
          <button class="btn" onclick="hapusItem(${i})">❌</button>
        `;
        list.appendChild(row);
      });
      document.getElementById("total").innerText = totalHarga.toLocaleString("id-ID");
      hitungKembalian();
    }

    function hapusItem(i) {
      pesanan.splice(i, 1);
      renderPesanan();
    }

    function hitungKembalian() {
      const bayar = parseInt(document.getElementById("bayar").value) || 0;
      const diskon = parseInt(document.getElementById("diskon").value) || 0;
      const totalSetelahDiskon = totalHarga - diskon;
      const kembalian = bayar - totalSetelahDiskon;
      document.getElementById("kembalian").innerText = kembalian >= 0 ? kembalian.toLocaleString("id-ID") : 0;
    }

    function resetPesanan() {
      pesanan = [];
      renderPesanan();
    }

    function showNotif(msg) {
      document.getElementById("notifMessage").innerText = msg;
      openPopup("notifPopup");
    }

    function openPopup(id) {
      document.getElementById(id).style.display = "flex";
    }

    function closePopup(id) {
      document.getElementById(id).style.display = "none";
    }

    function showSpinner(s) {
      document.getElementById("spinner").style.display = s ? "block" : "none";
    }

    function konfirmasiBayar() {
      if (pesanan.length === 0) {
        showNotif("Belum ada pesanan.");
        return;
      }
      showNotif("Pembayaran berhasil!");
      resetPesanan();
    }

    function logout() {
      sessionStorage.clear();
      window.location.href = "index.html";
    }
  </script>
</body>
</html>
